---
title: "Reproducible Research: Peer Assessment 1"
author: "Fabio Correa (@feamcor, coursera, data science specialization, repdata-035)"
date: "December 2015"
output: 
  html_document:
    fig_caption: yes
    keep_md: yes
    toc: yes
---

```{r setup, echo=FALSE}
library(knitr)
opts_chunk$set(echo=TRUE, tidy=FALSE, cache=FALSE, fig.path='figure/')
library(lattice)
script.name <- "PA1_template.Rmd"
start.time <- Sys.time()
start.time.text <- format(start.time, "_%Y%m%d_%H%M%S")
```

## Loading the Dataset
```{r load_dataset}
# if dataset zip file does not exist, download it
filename.zip <- "activity.zip"
if(!file.exists(filename.zip)) {
    dataset.url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
    download.file(url = dataset.url, destfile = filename.zip, method = "auto")
    message(paste(Sys.time(), "Dataset zip file downloaded!", filename.zip))
} else {
    message(paste(Sys.time(), "Dataset zip file already exists!", filename.zip))
}

# if dataset csv file does not exist, get it from zip file
filename.csv <- "activity.csv"
if(!file.exists(filename.csv)) {
    unzip(filename.zip, overwrite = TRUE)
    message(paste(Sys.time(), "Dataset file expanded!", filename.csv))
} else {
    message(paste(Sys.time(), "Dataset file already exists!", filename.csv))
}

# read dataset csv file
dataset <- read.csv(filename.csv,
                    header=TRUE,
                    colClasses=c("integer", "Date", "integer"))
str(dataset)
head(dataset)
summary(dataset)
```
The dataset contains __`r nrow(dataset)`__ observations!  
The variables included in the dataset are:

*  __steps__: Number of steps taken in a 5-minute interval (missing values are coded as NA)
*  __date__: The date on which the measurement was taken (YYYY-MM-DD)
*  __interval__: Identifier for the 5-minute interval in which measurement was taken

## Pre-processing the Dataset
```{r pre_process_dataset}
# create factor to indicate if date is of type weekday or weekend
weekend <- c("Sat", "Sun")
date.type <- factor(weekdays(dataset$date,
                             abbreviate = TRUE) %in% weekend,
                    levels = c(TRUE, FALSE),
                    labels = c('weekend', 'weekday'))
# bind new calculated factor to the original dataset
dataset <- cbind(dataset, date.type)
str(dataset)
head(dataset)
summary(dataset)
```
New column __date.type__ added to dataset indicating whether date is __weekday__ or __weekend__.

## Average Total Number of Steps Taken per Day
```{r steps_day}
# calculate total of steps taken by individual per day
stepsday <- aggregate(steps ~ date, data = dataset, FUN = sum)
str(stepsday)
head(stepsday)
summary(stepsday)
# plot its histogram
hist(stepsday$steps,
     freq=TRUE,
     plot=TRUE,
     main="Total Number of Steps Taken per Day (NAs ommitted)",
     xlab="Number of Steps",
     ylab="Number of Days",
     col=palette("default"))
# add evidence in the plot that it was generated by this script
par(oma=c(0,0,0,1), cex.sub=0.25)
mtext(paste("repdata-035 feamcor", script.name, start.time.text), side=4, outer=TRUE)
# calculate mean and median
stepsday.mean <- mean(stepsday$steps)
stepsday.median <- median(stepsday$steps)
```
Individual took an average (mean) of __`r as.integer(round(stepsday.mean))`__ steps per day.  
The median was a day where individual took __`r as.integer(round(stepsday.median))`__ steps.

## Average Daily Activity Pattern
```{r average_pattern}
# calculate average of steps taken by individual per interval
avgpattern <- aggregate(steps ~ interval, data = dataset, FUN = mean)
str(avgpattern)
head(avgpattern)
summary(avgpattern)
# plot its timeseries
plot(avgpattern$interval,
     avgpattern$steps,
     type="l",
     main="Average Number of Steps Taken by Interval (NAs ommitted)",
     xlab="5-minutes interval (HHMM) in a day",
     ylab="Steps (average)")
# add evidence in the plot that it was generated by this script
par(oma=c(0,0,0,1), cex.sub=0.25)
mtext(paste("repdata-035 feamcor", script.name, start.time.text), side=4, outer=TRUE)
# find interval with maximum number of steps
max.row <- which.max(avgpattern$steps)
max.interval <- avgpattern[max.row, "interval"]
max.steps <- avgpattern[max.row, "steps"]
```
Individual most active 5-minute interval was at __`r sprintf("%04i", max.interval)`__ with an average of __`r as.integer(round(max.steps))`__ steps taken.

## Missing Values in the Dataset
```{r missing_values}
# calculate total number of missing values in the dataset
steps.NA <- sum(is.na(dataset$steps))
# calculate average of steps taken by individual per interval and date type
filler <- aggregate(steps ~ interval + date.type, data = dataset, FUN = mean)
str(filler)
head(filler)
summary(filler)
# create new dataset by merging data frames
dataset.noNA <- merge(dataset, filler, by = c("interval", "date.type"), all.x = TRUE)
str(dataset.noNA)
head(dataset.noNA)
# fill the missing values in order to be able to derive plot based on one column only (steps.x)
dataset.noNA$steps.x[is.na(dataset.noNA$steps.x)] <- dataset.noNA$steps.y[is.na(dataset.noNA$steps.x)]
head(dataset.noNA)
summary(dataset.noNA)
# calculate total of steps taken by individual per day
stepsday.noNA <- aggregate(steps.x ~ date, data = dataset.noNA, FUN = sum)
head(stepsday.noNA)
summary(stepsday.noNA)
# plot its histogram
hist(stepsday.noNA$steps.x,
     freq=TRUE,
     plot=TRUE,
     main="Total Number of Steps Taken per Day (no NAs)",
     xlab="Number of Steps",
     ylab="Number of Days",
     col=palette("default"))
# add evidence in the plot that it was generated by this script
par(oma=c(0,0,0,1), cex.sub=0.25)
mtext(paste("repdata-035 feamcor", script.name, start.time.text), side=4, outer=TRUE)
# calculate mean and median
stepsday.noNA.mean <- mean(stepsday.noNA$steps)
stepsday.noNA.median <- median(stepsday.noNA$steps)
```
There are __`r steps.NA`__ rows in the dataset with missing values for the __steps__ variable.  
These variables were filled with the average of steps within the 5-minute interval according to the date type (weekday or weekend).  
Based on these changes:  

* Individual took an average (mean) of __`r as.integer(round(stepsday.noNA.mean))`__ steps per day.  
* The median was a day where individual took __`r as.integer(round(stepsday.noNA.median))`__ steps.

## Differences in Activity Patterns
```{r diff_patterns}
# calculate average of steps by individual per interval
diffpattern <- aggregate(steps.x ~ interval + date.type, data = dataset.noNA, FUN = mean)
str(diffpattern)
head(diffpattern)
# plot timeseries
xyplot(steps.x ~ interval | date.type,
       data=diffpattern,
       layout=c(1,2),
       type="l",
       xlab="5-minutes interval (HHMM)",
       ylab="Steps (average)",
       main="Average Number of Steps Taken by Interval per Date Type (no NAs)",
       sub=paste("repdata-035 feamcor", script.name, start.time.text))
```
---
By [feamcor](https://github.com/feamcor).
